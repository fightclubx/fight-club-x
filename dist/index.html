<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>Fight Club X</title>
  

</head>
<body>
<!-- partial:index.partial.html -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FIGHTCLUB — The Basement</title>
<style>
  :root{
    --bg:#070707; --bg-2:#0b0b0b; --ink:#e5e5e5; --muted:#8a8a8a;
    --accent:#dc2626; --line:rgba(255,255,255,.08); --glass:rgba(0,0,0,.6);
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%; overflow-x:hidden} /* Changed: removed overflow:hidden, only hide horizontal */
  body{
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    color:var(--ink);
    background:
      radial-gradient(120% 90% at 50% 10%, rgba(255,255,255,.05) 0 20%, transparent 60%),
      linear-gradient(rgba(0,0,0,.85), rgba(0,0,0,.85)),
      url('https://i.imgur.com/xuBF3dU.png') center/cover fixed no-repeat;
    line-height:1.55;
  }
  
  body::before{
    content:""; position:fixed; inset:0; pointer-events:none;
    background:
      repeating-linear-gradient(0deg, rgba(255,255,255,.03) 0 1px, transparent 1px 3px),
      linear-gradient(to bottom, rgba(0,0,0,.15) 0%, rgba(0,0,0,.45) 45%, rgba(0,0,0,.70) 80%, rgba(0,0,0,.85) 100%);
    mix-blend-mode:soft-light; opacity:.9;
  }

  .container{
    min-height:100vh; display:flex; flex-direction:column; /* Changed: min-height instead of height */
    max-width:1600px; margin:0 auto; padding:12px;
  }

  /* HEADER WITH LORE */
  .header{
    text-align:center; margin-bottom:20px; flex-shrink:0; margin-top:-20px; /* Increased negative margin to pull it up more */
  }
  .logo{width:120px; filter:drop-shadow(0 0 12px rgba(0,0,0,.6)); margin-bottom:8px}
  .title{
    font-size:1.8rem; font-weight:bold; color:var(--ink);
    text-transform:uppercase; letter-spacing:.1em; margin-bottom:4px;
  }
  .subtitle{
    font-size:.9rem; color:var(--muted); text-transform:uppercase; 
    letter-spacing:.25em; margin-bottom:12px;
  }
  .lore{
    max-width:600px; margin:0 auto 16px; color:#bcbcbc; 
    font-size:.9rem; line-height:1.6; opacity:.9;
  }
  /* TOP BAR FOR CONTRACT/JOIN */
  .top-bar{
    display:flex; justify-content:flex-end; align-items:center;
    gap:12px; margin-bottom:4px; padding:0 12px; /* Further reduced margin-bottom */
  }
  
  .status-bar{
    display:flex; justify-content:center; align-items:center;
    margin-bottom:20px;
  }
  .battle-info{
    text-align:center; position:relative;
  }
  .status-pill{
    font-family: ui-monospace, Menlo, Consolas, monospace;
    font-size:1rem; font-weight:600; text-transform:uppercase; letter-spacing:.15em;
    padding:16px 24px; border:2px solid var(--accent); 
    background:linear-gradient(135deg, var(--bg-2) 0%, rgba(220,38,38,.1) 100%);
    color:var(--ink); margin-bottom:8px; position:relative; overflow:hidden;
    box-shadow:0 0 20px rgba(220,38,38,.3), inset 0 1px 0 rgba(255,255,255,.1);
  }
  .status-pill::before{
    content:""; position:absolute; top:0; left:-100%; width:100%; height:100%;
    background:linear-gradient(90deg, transparent, rgba(255,255,255,.1), transparent);
    animation:shimmer 3s infinite;
  }
  @keyframes shimmer{
    0%{left:-100%}
    50%{left:100%}
    100%{left:100%}
  }
  .countdown-text{
    font-size:1.2rem; color:var(--accent); font-weight:bold;
    text-shadow:0 0 8px rgba(220,38,38,.5);
  }
  .battle-schedule{
    font-size:.8rem; color:var(--muted); text-transform:uppercase;
    letter-spacing:.2em; opacity:.9; font-weight:500;
  }
  .top-right-controls{
    display:flex; gap:12px; align-items:center;
  }
  .contract-section{
    display:flex; align-items:center; gap:8px;
  }
  .contract-input{
    font-family: ui-monospace, Menlo, Consolas, monospace;
    font-size:.75rem; padding:8px 12px; background:var(--bg-2);
    border:1px solid var(--line); color:var(--ink); width:160px;
    text-overflow:ellipsis; overflow:hidden; white-space:nowrap;
    cursor:pointer; transition:all .2s ease;
  }
  .contract-input:hover{border-color:var(--muted)}
  .copy-btn{
    font-size:.75rem; padding:8px 12px; border:1px solid var(--line); 
    background:var(--bg-2); color:var(--ink); cursor:pointer;
    transition:all .2s ease; text-transform:uppercase; letter-spacing:.1em;
  }
  .copy-btn:hover{background:rgba(255,255,255,.05); border-color:var(--muted)}
  .copy-btn.copied{background:var(--accent); color:#fff; border-color:var(--accent)}
  /* GitHub Icon Button */
  .github-btn{
    display:flex; align-items:center; justify-content:center;
    padding:10px 10px; border:1px solid var(--line); 
    background:var(--bg-2); color:var(--ink); cursor:pointer;
    transition:all .2s ease; text-decoration:none;
    box-shadow:0 0 5px rgba(0,0,0,.3);
  }
  .github-btn:hover{
    background:rgba(255,255,255,.05); border-color:var(--muted);
    box-shadow:0 0 10px rgba(255,255,255,.1);
  }
  .github-btn svg{
    width:25px; height:25px; fill:currentColor;
    transition:fill .2s ease;
  }
  .github-btn:hover svg{
    fill:var(--ink);
  }
  .join-btn{
    font-size:.85rem; text-transform:uppercase; letter-spacing:.1em;
    padding:10px 16px; border:1px solid var(--accent); color:#fff; 
    text-decoration:none; background:var(--accent);
    transition:all .2s ease; box-shadow:0 0 10px rgba(220,38,38,.3);
  }
  .join-btn:hover{background:rgba(220,38,38,.8); box-shadow:0 0 15px rgba(220,38,38,.5)}

  /* MAIN LAYOUT - 2 COLUMNS */
  .main-layout{
    display:grid; grid-template-columns:1fr 280px; gap:16px; 
    flex:1; min-height:0; margin-bottom:20px; /* Added margin-bottom for spacing */
  }

  /* ARENA SECTION - WIDESCREEN */
  .arena-section{
    background:var(--glass); border:1px solid var(--line); 
    display:flex; flex-direction:column; overflow:hidden;
    height:100vh; /* Changed: set to full viewport height */
  }
  .section-header{
    padding:8px 12px; border-bottom:1px solid var(--line);
    font-family:ui-monospace, Menlo, Consolas, monospace; 
    font-size:.8rem; color:var(--muted); letter-spacing:.05em;
    background:linear-gradient(to right, rgba(255,255,255,.02), transparent);
    display:flex; justify-content:space-between; align-items:center;
  }
  
  .video-container{
    background:#000; display:flex; 
    align-items:center; justify-content:center; position:relative;
    flex:1; height:100%; /* Added height:100% for full height utilization */
  }
  .arena-video{width:100%; height:100%; object-fit:cover} /* Changed: object-fit from contain to cover */
  .arena-placeholder{
    text-align:center; color:#888; padding:40px;
  }
  .arena-placeholder h3{font-size:1.3rem; margin-bottom:8px; color:#bbb}
  .arena-placeholder p{font-size:.9rem}

  /* STATS TABLE */
  .stats-section{
    flex:1; display:flex; flex-direction:column; overflow:hidden;
    min-height:250px; /* Added minimum height for stats section */
  }
  .stats-table-container{
    flex:1; overflow-y:auto; border-top:1px solid var(--line);
    max-height:300px; /* Added max-height to create scrollable container */
  }
  .stats-table{
    width:100%; border-collapse:collapse; font-size:.85rem;
    table-layout:fixed; /* Force fixed column widths */
  }
  .stats-table th{
    background:var(--bg-2); padding:8px 12px; 
    border-bottom:1px solid var(--line); color:var(--muted);
    font-family: ui-monospace, Menlo, Consolas, monospace;
    font-size:.75rem; text-transform:uppercase; letter-spacing:.1em;
    cursor:pointer; user-select:none; position:sticky; top:0;
    transition:background .2s ease; white-space:nowrap;
    vertical-align:middle; height:36px; overflow:hidden;
    position:relative;
  }
  .stats-table th:hover{background:rgba(255,255,255,.05)}
  .stats-table th.sorted-asc::after,
  .stats-table th.sorted-desc::after{
    position:absolute; right:8px; top:50%;
    transform:translateY(-50%); color:var(--accent);
    font-size:.9rem; line-height:1;
  }
  .stats-table th.sorted-asc::after{content:'↑'}
  .stats-table th.sorted-desc::after{content:'↓'}
  
  .stats-table td{
    padding:6px 12px; border-bottom:1px solid var(--line);
    font-family: ui-monospace, Menlo, Consolas, monospace;
    vertical-align:middle; height:32px; overflow:hidden;
    text-overflow:ellipsis; white-space:nowrap; font-size:.8rem;
  }
  .stats-table tr:hover{background:rgba(255,255,255,.02)}
  
  /* Fixed column widths */
  .rank-col{width:60px; text-align:center; color:var(--muted)}
  .player-col{width:160px; text-align:left; color:#ddd; font-weight:500}
  .stat-col{width:80px; text-align:right; color:var(--ink)}
  .damage-col{width:100px; text-align:right; color:var(--ink)}
  .received-col{width:100px; text-align:right; color:var(--ink)}

  /* RIGHT SIDEBAR - SIMPLE SIMULATIONS */
  .sims-section{
    background:var(--glass); border:1px solid var(--line);
    display:flex; flex-direction:column; overflow:hidden;
  }
  .sims-controls{
    padding:8px 12px; border-bottom:1px solid var(--line);
  }
  .sort-select{
    width:100%; padding:6px 10px; background:var(--bg-2); 
    border:1px solid var(--line); color:var(--ink); font-size:.8rem;
    font-family: ui-monospace, Menlo, Consolas, monospace;
  }
  .sort-select option{background:var(--bg-2); color:var(--ink)}
  
  .sims-list{
    flex:1; overflow-y:auto; overflow-x:hidden;
    max-height:500px; /* Added max-height for better scrolling */
  }
  .sim-item{
    padding:8px 12px; border-bottom:1px solid var(--line);
    cursor:pointer; transition:background .2s ease;
    font-family: ui-monospace, Menlo, Consolas, monospace;
    font-size:.8rem; color:#ddd;
  }
  .sim-item:hover{background:rgba(255,255,255,.02)}
  .sim-item.active{
    background:rgba(220,38,38,.1); 
    border-left:3px solid var(--accent);
  }

  /* RESPONSIVE */
  @media (max-width: 1100px){
    .main-layout{
      grid-template-columns:1fr; 
      grid-template-rows:auto 1fr;
    }
    .sims-section{max-height:200px}
    .top-bar{justify-content:center; margin-bottom:16px}
    .top-right-controls{justify-content:center; flex-wrap:wrap}
    .contract-input{width:140px}
    .status-pill{font-size:.9rem; padding:12px 20px}
    .countdown-text{font-size:1.1rem}
    .video-container{max-height:50vh} /* Adjust video height on mobile */
    .stats-table-container{max-height:200px} /* Smaller stats height on mobile */
  }

  /* CUSTOM SCROLLBAR */
  .sims-list::-webkit-scrollbar,
  .stats-table-container::-webkit-scrollbar{width:6px}
  .sims-list::-webkit-scrollbar-track,
  .stats-table-container::-webkit-scrollbar-track{background:var(--bg)}
  .sims-list::-webkit-scrollbar-thumb,
  .stats-table-container::-webkit-scrollbar-thumb{
    background:var(--line); border-radius:3px;
  }
  .sims-list::-webkit-scrollbar-thumb:hover,
  .stats-table-container::-webkit-scrollbar-thumb:hover{background:var(--muted)}

  /* NO STATS MESSAGE */
  .no-stats{
    flex:1; display:flex; align-items:center; justify-content:center;
    color:#888; font-size:.9rem; text-align:center; padding:40px;
  }
</style>
</head>
<body>
  <div class="container">
    <!-- TOP BAR WITH CONTRACT & JOIN -->
    <div class="top-bar">
      <div class="top-right-controls">
        <div class="contract-section">
          <input class="contract-input" id="contractAddress" value="CA: 8p5Ym5w9VVFnBJ5zNewPFXXMfCxiw7dSgohavowopump" readonly onclick="copyContract()">
          <button class="copy-btn" id="copyBtn" onclick="copyContract()">Copy</button>
        </div>
        <a class="github-btn" href="https://github.com/fightclubx/fight-club-x" target="_blank" title="View on GitHub">
          <svg viewBox="0 0 24 24">
            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
          </svg>
        </a>
        <a class="join-btn" href="https://twitter.com/fightclubxsol" target="_blank">Join on X</a>
      </div>
    </div>

    <!-- HEADER WITH LORE -->
    <header class="header">
      <img class="logo" src="https://i.imgur.com/J4nq03v.png" alt="Fight Club" />
      <div class="subtitle">Welcome to the Algorithm's Underground</div>
      <div class="lore">
        A simulated environment where our X community<br>
        fight it out to prove who's the best. Livestreamed on X daily.
      </div>
      <div class="status-bar">
        <div class="battle-info">
          <div class="status-pill">Next Battle: <span class="countdown-text" id="countdown">--:--:--</span></div>
          <div class="battle-schedule">Battles every 6 hours UTC</div>
        </div>
      </div>
    </header>

    <!-- MAIN LAYOUT -->
    <div class="main-layout">
      <!-- ARENA & STATS -->
      <section class="arena-section">
        <div class="section-header">
          <span>/arena</span>
          <span id="currentSim">Select a simulation</span>
        </div>
        
        <!-- 16:9 VIDEO -->
        <div class="video-container" id="videoContainer">
          <div class="arena-placeholder">
            <h3>Ready for Battle</h3>
            <p>Select a simulation to begin</p>
          </div>
        </div>

        <!-- STATS TABLE -->
        <div class="stats-section">
          <div class="stats-table-container" id="statsContainer" style="display:none">
            <table class="stats-table">
              <thead>
                <tr>
                  <th class="rank-col" data-sort="rank">Pos</th>
                  <th class="player-col" data-sort="player">Player</th>
                  <th class="stat-col" data-sort="kills">Kills</th>
                  <th class="stat-col" data-sort="deaths">Deaths</th>
                  <th class="damage-col" data-sort="damage">Damage</th>
                  <th class="received-col" data-sort="received">Received</th>
                </tr>
              </thead>
              <tbody id="statsTableBody">
              </tbody>
            </table>
          </div>
          <div class="no-stats" id="noStats">
            Select a simulation to view player statistics
          </div>
        </div>
      </section>

      <!-- RIGHT SIDEBAR - SIMPLE SIMULATIONS -->
      <section class="sims-section">
        <div class="section-header">/simulations</div>
        <div class="sims-controls">
          <select class="sort-select" id="sortSelect">
            <option value="date-desc">Date: Newest First</option>
            <option value="date-asc">Date: Oldest First</option>
          </select>
        </div>
        <div class="sims-list" id="simsList"></div>
      </section>
    </div>
  </div>

<script>
  // Configuration
  const GITHUB_BASE = 'https://fightclubx.github.io/fight-club-x/public';
  
  // Fix path resolution for GitHub Pages
  const resolve = (p) => {
    // Remove leading slash if present
    const cleanPath = p.startsWith('/') ? p.slice(1) : p;
    return `${GITHUB_BASE}/${cleanPath}`;
  };
  const MANIFEST_URL = resolve('data/manifest.json');

  // Helpers
  const $ = s => document.querySelector(s);
  const $$ = s => [...document.querySelectorAll(s)];
  const pad = n => String(n).padStart(2,'0');

  let MANIFEST = null;
  let CURRENT_STATS = null;
  let SORT_COLUMN = 'rank';
  let SORT_DIRECTION = 'asc';

  // Initialize
  loadManifest();

  // Copy contract address function
  function copyContract() {
    const contractInput = $('#contractAddress');
    const copyBtn = $('#copyBtn');
    
    // Select and copy the text
    contractInput.select();
    contractInput.setSelectionRange(0, 99999); // For mobile devices
    
    try {
      navigator.clipboard.writeText(contractInput.value).then(() => {
        // Visual feedback
        copyBtn.textContent = 'Copied!';
        copyBtn.classList.add('copied');
        
        setTimeout(() => {
          copyBtn.textContent = 'Copy';
          copyBtn.classList.remove('copied');
        }, 2000);
      }).catch(() => {
        // Fallback for older browsers
        document.execCommand('copy');
        copyBtn.textContent = 'Copied!';
        copyBtn.classList.add('copied');
        
        setTimeout(() => {
          copyBtn.textContent = 'Copy';
          copyBtn.classList.remove('copied');
        }, 2000);
      });
    } catch (err) {
      console.log('Copy failed:', err);
    }
  }

  async function loadManifest(){
    try{
      console.log('Loading manifest from:', MANIFEST_URL);
      const res = await fetch(MANIFEST_URL, { 
        cache: 'no-store',
        mode: 'cors'
      });
      if(!res.ok) throw new Error(`Manifest not found: ${res.status}`);
      MANIFEST = await res.json();
      console.log('Manifest loaded:', MANIFEST);

      setupCountdown(); // Remove the parameter since we're calculating it automatically
      renderSimulations(MANIFEST.simulations || []);
      
      // Auto-load latest simulation
      const latest = (MANIFEST.simulations || [])[0];
      if(latest) loadSimulation(latest.slug);

    }catch(e){
      console.warn('Failed to load manifest:', e);
      $('#simsList').innerHTML = '<div style="padding:20px;text-align:center;color:#888;">No simulations available</div>';
      
      // Try to provide helpful error message
      if(e.message.includes('CORS')) {
        console.error('CORS Error: The files need to be served from the same domain or have proper CORS headers.');
      }
    }
  }

  function setupCountdown(timestamp){
    // Calculate next 6-hour battle time based on UTC
    const calculateNextBattle = () => {
      const now = new Date();
      const currentUTCHour = now.getUTCHours();
      
      // Find the next 6-hour interval (0, 6, 12, 18)
      const battleHours = [0, 6, 12, 18];
      let nextBattleHour = battleHours.find(hour => hour > currentUTCHour);
      
      // If no battle found today, next battle is at 00:00 tomorrow
      if (!nextBattleHour) {
        nextBattleHour = 0;
        now.setUTCDate(now.getUTCDate() + 1);
      }
      
      // Set the target time
      const target = new Date(now);
      target.setUTCHours(nextBattleHour, 0, 0, 0);
      
      return target;
    };
    
    let target = calculateNextBattle();
    
    const updateCountdown = () => {
      const now = new Date();
      const diff = target - now;
      
      if(diff <= 0) {
        // Recalculate next battle time
        target = calculateNextBattle();
        return;
      }
      
      const h = Math.floor(diff/3_600_000);
      const m = Math.floor((diff%3_600_000)/60_000);
      const s = Math.floor((diff%60_000)/1000);
      $('#countdown').textContent = `${pad(h)}:${pad(m)}:${pad(s)}`;
    };
    
    updateCountdown();
    setInterval(updateCountdown, 1000);
  }

  function renderSimulations(simulations){
    const sortBy = $('#sortSelect').value;
    
    const sorted = [...simulations].sort((a,b) => {
      if(sortBy === 'date-desc') return (b.slug||'').localeCompare(a.slug||'');
      if(sortBy === 'date-asc') return (a.slug||'').localeCompare(b.slug||'');
      return 0;
    });

    $('#simsList').innerHTML = sorted.map(sim => {
      const time = sim.slug ? sim.slug.split('_')[1]?.replace(/-/g, ':') : '';
      return `
        <div class="sim-item" data-slug="${sim.slug}" onclick="loadSimulation('${sim.slug}')">
          ${sim.date || 'Unknown'} ${time}
        </div>
      `;
    }).join('');
  }

  async function loadSimulation(slug){
    const sim = (MANIFEST?.simulations || []).find(s => s.slug === slug);
    if(!sim) return;

    // Update active state
    $$('.sim-item').forEach(item => item.classList.remove('active'));
    $(`.sim-item[data-slug="${slug}"]`)?.classList.add('active');

    $('#currentSim').textContent = sim.date;

    // Load video
    const videoUrl = resolve(sim.video);
    $('#videoContainer').innerHTML = `
      <video class="arena-video" controls autoplay>
        <source src="${videoUrl}" type="video/mp4">
        Video not supported
      </video>
    `;

    // Load and display stats
    await loadStats(sim);
    renderStatsTable();
  }

  async function loadStats(sim){
    try{
      console.log('Loading stats for sim:', sim); // Debug log
      
      if(!sim.stats) {
        console.log('No stats file specified');
        CURRENT_STATS = null;
        return;
      }

      const statsUrl = resolve(sim.stats);
      console.log('Stats URL:', statsUrl); // Debug log
      
      const response = await fetch(statsUrl, {
        cache: 'no-store',
        mode: 'cors'
      });
      if(!response.ok) {
        console.log('Stats fetch failed:', response.status);
        throw new Error('Stats not found');
      }
      
      const data = await response.json();
      console.log('Raw stats data:', data); // Debug log
      
      const interactions = data.interactions || data;
      console.log('Interactions:', interactions); // Debug log

      // Load ranking data if available
      let rankings = {};
      if(sim.ranking) {
        try{
          const rankUrl = resolve(sim.ranking);
          console.log('Ranking URL:', rankUrl); // Debug log
          
          const rankResponse = await fetch(rankUrl, {
            cache: 'no-store',
            mode: 'cors'
          });
          if(rankResponse.ok) {
            rankings = await rankResponse.json();
            console.log('Rankings:', rankings); // Debug log
          }
        }catch(e){
          console.log('Ranking fetch failed:', e);
        }
      }

      // Process player data
      const players = Object.keys(interactions).map(player => {
        const stats = interactions[player];
        return {
          player,
          kills: stats.killsTotal ?? stats.kills ?? 0,
          deaths: stats.deathsTotal ?? stats.deaths ?? 0,
          damage: Math.round(stats.damageDealt ?? stats.damage ?? 0),
          received: Math.round(stats.damageReceived ?? 0),
          rank: rankings[player] !== undefined ? rankings[player] + 1 : null
        };
      });

      console.log('Processed players:', players); // Debug log
      CURRENT_STATS = players;

    }catch(e){
      console.warn('Failed to load stats:', e);
      CURRENT_STATS = null;
    }
  }

  function renderStatsTable(){
    if(!CURRENT_STATS || CURRENT_STATS.length === 0) {
      $('#statsContainer').style.display = 'none';
      $('#noStats').style.display = 'flex';
      return;
    }

    $('#statsContainer').style.display = 'block';
    $('#noStats').style.display = 'none';

    // Sort data
    const sorted = [...CURRENT_STATS].sort((a, b) => {
      let aVal = a[SORT_COLUMN];
      let bVal = b[SORT_COLUMN];
      
      if(SORT_COLUMN === 'player') {
        aVal = aVal.toLowerCase();
        bVal = bVal.toLowerCase();
      }
      
      if(SORT_COLUMN === 'rank') {
        // Handle null ranks (put them at end)
        if(aVal === null) aVal = 9999;
        if(bVal === null) bVal = 9999;
      }

      if(SORT_DIRECTION === 'asc') {
        return aVal > bVal ? 1 : -1;
      } else {
        return aVal < bVal ? 1 : -1;
      }
    });

    // Update column headers
    $$('.stats-table th').forEach(th => {
      th.classList.remove('sorted-asc', 'sorted-desc');
      if(th.dataset.sort === SORT_COLUMN) {
        th.classList.add(`sorted-${SORT_DIRECTION}`);
      }
    });

    // Render rows
    $('#statsTableBody').innerHTML = sorted.map((player, index) => {
      const position = SORT_COLUMN === 'rank' && player.rank !== null ? player.rank : index + 1;
      const rankDisplay = player.rank !== null ? player.rank : position;
      
      return `
        <tr>
          <td class="rank-col">${rankDisplay}</td>
          <td class="player-col">@${player.player}</td>
          <td class="stat-col">${player.kills}</td>
          <td class="stat-col">${player.deaths}</td>
          <td class="damage-col">${player.damage}</td>
          <td class="received-col">${player.received}</td>
        </tr>
      `;
    }).join('');
  }

  // Event listeners
  $('#sortSelect').addEventListener('change', () => {
    renderSimulations(MANIFEST?.simulations || []);
  });

  // Table column sorting
  $$('.stats-table th[data-sort]').forEach(th => {
    th.addEventListener('click', () => {
      const column = th.dataset.sort;
      
      if(SORT_COLUMN === column) {
        SORT_DIRECTION = SORT_DIRECTION === 'asc' ? 'desc' : 'asc';
      } else {
        SORT_COLUMN = column;
        SORT_DIRECTION = column === 'rank' ? 'asc' : 'desc'; // Default to best first for most stats
      }
      
      renderStatsTable();
    });
  });
</script>
</body>
</html>
<!-- partial -->
  
</body>
</html>
